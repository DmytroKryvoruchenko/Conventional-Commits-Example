#-----------------------------------------------------------------
# https://git-cliff.org/docs/configuration/changelog
[changelog]

header = "# Changelog"

body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
## {{ group | upper_first }}

{% for commit in commits %}
{% set message_parts = commit.message | split(pat="\n\n") %}
{% set first_line = message_parts[0] | trim %}
{% set second_line = "" %}
{% if message_parts | length > 1 %}
  {% set second_line = message_parts[1] | trim %}
{% endif %}
{% set type = first_line | split(pat=":") | first | trim %}

{% if first_line != "" %}
  {% if message_parts | length == 1 %}
  - {{ first_line }}
  {% elif second_line != "" %}
  - {{ type }}: {{ second_line }}
  {% endif %}
{% endif %}

{% endfor %}
{% endfor %}
"""

footer = ""

trim = true

postprocessors = [
  # { pattern = '<REPO>', replace = "https://github.com/orhun/git-cliff" }, # replace repository URL
]
# render body even when there are no releases to process
# render_always = true

output = "CHANGELOG.md"
#-----------------------------------------------------------------
[git]
conventional_commits = true
filter_unconventional = false
split_commits = false

branch = "{{ git.branch }}"

commit_preprocessors = [
   { pattern = "Merged PR [0-9]+: ", replace = "" },
   { pattern = "(Related work items|Refs|Closes):? ?#?([0-9]+)(, ?#?([0-9]+))*,?", replace = "" },
   #{ pattern = "([0-9]+)", replace = "[${1}](https://tfsaura.visualstudio.com/AURA%20digital%20kundestrategi/_workitems/edit/${1})" }
]

commit_parsers = [
  { message = "^Merge branch", skip = true },
  { message = "^(feat|feature)", group = "Features" },
  { message = "^change", group = "Change requests" },
  { message = "^(fix|bug|bugfix)", group = "Bug Fixes" },
  { message = "^doc", group = "Documentation" },
  { message = "^perf", group = "Performance" },
  { message = "^refactor", group = "Refactoring" },
  { message = "^test", group = "Testing" },
  { message = ".*", group = "Other" },
]

filter_commits = true
topo_order = false
sort_commits = "oldest"
#-----------------------------------------------------------------
# https://git-cliff.org/docs/configuration/bump
[bump]
features_always_bump_minor = false
breaking_always_bump_major = false
initial_tag = "1.0.0"
#-----------------------------------------------------------------